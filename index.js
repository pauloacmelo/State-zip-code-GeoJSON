const CALIFORNIA_ZIPCODES_PATH = "ca_california_zip_codes_geo.min.json";

const pricing = {
  "Double $175": [
    94020, 94021, 94074, 94087, 94516, 94530, 94536, 94539, 94546, 94547, 94549,
    94552, 94555, 94556, 94560, 94563, 94564, 94570, 94575, 94577, 94578, 94579,
    94587, 94595, 94597, 94619, 94624, 94708, 94801, 94802, 94803, 94804, 94805,
    94806, 94807, 94808, 94820, 94850, 94912, 94914, 94939, 94957, 94964, 94970,
    95002, 95035, 95036, 95050, 95051, 95052, 95053, 95054, 95055, 95056, 95101,
    95103, 95106, 95108, 95109, 95110, 95112, 95113, 95115, 95117, 95129, 95131,
    95134, 95150, 95161, 95164, 95170, 95173, 95190, 95194, 95196, 95070, 95130,
    95008, 95032, 95030, 94538,
  ],
  "Double $225": [94020, 94021],
  "Extended $150": [
    94018, 94019, 94037, 94038, 94040, 94041, 94085, 94086, 94088, 94089, 94501,
    94502, 94540, 94541, 94542, 94543, 94544, 94545, 94557, 94580, 94601, 94602,
    94603, 94604, 94605, 94606, 94607, 94608, 94609, 94610, 94611, 94612, 94613,
    94614, 94615, 94617, 94618, 94620, 94621, 94622, 94623, 94625, 94649, 94659,
    94660, 94661, 94662, 94666, 94701, 94702, 94703, 94704, 94705, 94706, 94707,
    94709, 94710, 94712, 94720, 94920, 94925, 94941, 94942, 94965, 94966, 94976,
    95014, 95015,
  ],
  "Local $100": [
    94005, 94010, 94011, 94013, 94014, 94015, 94016, 94017, 94022, 94023, 94024,
    94025, 94026, 94027, 94028, 94030, 94035, 94039, 94042, 94043, 94044, 94061,
    94062, 94063, 94064, 94065, 94066, 94070, 94080, 94083, 94101, 94102, 94103,
    94104, 94105, 94106, 94107, 94108, 94109, 94110, 94111, 94112, 94114, 94115,
    94116, 94117, 94118, 94119, 94120, 94121, 94122, 94123, 94124, 94125, 94126,
    94127, 94128, 94129, 94130, 94131, 94132, 94133, 94134, 94135, 94136, 94137,
    94138, 94139, 94140, 94141, 94142, 94143, 94144, 94145, 94146, 94147, 94150,
    94151, 94152, 94153, 94154, 94155, 94156, 94158, 94159, 94160, 94161, 94162,
    94163, 94164, 94171, 94172, 94175, 94177, 94188, 94199, 94301, 94302, 94303,
    94304, 94305, 94306, 94309, 94401, 94402, 94403, 94404, 94497,
  ],
};

const fs = require("fs");
const turf = require("@turf/turf");
const j = JSON.parse(fs.readFileSync(CALIFORNIA_ZIPCODES_PATH));

fs.writeFileSync("output/shopify_delivery.geojson", JSON.stringify({
  type: "FeatureCollection",
  features: Object.entries(pricing).map(([name, zipcodes]) => {
    const features = j.features.filter((f) =>
      zipcodes.map(String).includes(f.properties.ZCTA5CE10)
    );
    return {
      properties: { name },
      ...features.reduce((acc, cur) => turf.union(acc, cur)),
    };
  }),
}));
// const [name, zipcodes] = Object.entries(pricing)[1];
// const features = j.features.filter(f => zipcodes.map(String).includes(f.properties.ZCTA5CE10))
// console.log('name', name, features.length)
// const mergedFeature = ;
// console.log(JSON.stringify(mergedFeature));
